<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pro Report Studio v10.0 - 專業公務報表設計工具，支援 Excel/JSON 匯入、公式計算、PDF 直接下載">
    <meta name="keywords" content="報表設計, 公務報表, PDF, Excel, 列印">
    <meta name="author" content="Pro Report Studio">

    <!-- Open Graph -->
    <meta property="og:title" content="Pro Report Studio v10.0 - 公務報表專用版">
    <meta property="og:description" content="專業報表設計工具，支援 Excel/JSON 匯入與 PDF 直接下載">
    <meta property="og:type" content="website">

    <title>Pro Report Studio v10.0 - 公務報表專用版</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Material+Symbols+Outlined"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" crossorigin="anonymous"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>

    <!-- SheetJS (Excel 解析) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous"></script>

    <!-- jsPDF + html2canvas (PDF 直接下載) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
        crossorigin="anonymous"></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="title">
            <span class="material-symbols-outlined">description</span>
            Pro Report v10.0 公務版
        </div>
        <nav class="toolbar">
            <button class="btn" onclick="undo()" title="Ctrl+Z">↩ 復原</button>
            <button class="btn" onclick="saveProject()">💾 存檔</button>
            <button class="btn" onclick="loadProject()">📂 讀檔</button>
            <input type="file" id="f-proj" class="hidden-input" accept=".prs">
            <div class="toolbar-divider"></div>
            <button class="btn" onclick="openModal('modal-templates')" title="範本庫">📁 範本庫</button>
            <div class="toolbar-divider"></div>
            <button class="btn" onclick="openModal('modal-preview')" title="預覽">👁 預覽</button>
            <button class="btn btn-primary" onclick="printDoc()">🖨 列印</button>
            <button class="btn btn-primary" onclick="downloadPdf()">📥 下載 PDF</button>
        </nav>
    </header>

    <!-- Main Layout -->
    <main class="main-layout">
        <!-- Left Panel: Tools -->
        <aside class="left-panel" id="left-panel">
            <button class="panel-toggle panel-toggle-left" id="toggle-left" onclick="togglePanel('left')"
                title="收合/展開左側面板">
                <span class="material-symbols-outlined">chevron_left</span>
            </button>
            <div class="panel-content" id="left-panel-content">
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="t1">元件工具</button>
                    <button class="tab-btn" data-tab="t2">資料/底圖</button>
                    <button class="tab-btn" data-tab="t3">快速範本</button>
                </div>

                <!-- Tab 1: Components -->
                <section id="t1" class="tab-content active">
                    <div class="btn-grid">
                        <button class="btn" onclick="addEl('text','文字')">
                            <span class="material-symbols-outlined">text_fields</span> 文字
                        </button>
                        <button class="btn" onclick="addEl('title','標題',null,null,300,40,24,'bold')">
                            <span class="material-symbols-outlined">title</span> 標題
                        </button>
                        <button class="btn"
                            onclick="addEl('text','',50,50,100,100,12,'normal','transparent','2px solid #000000')">
                            <span class="material-symbols-outlined">check_box_outline_blank</span> 矩形
                        </button>
                        <button class="btn"
                            onclick="addEl('text','',50,50,200,0,12,'normal','transparent','1px solid #000000')">
                            <span class="material-symbols-outlined">horizontal_rule</span> 橫線
                        </button>
                        <button class="btn"
                            onclick="addEl('text','',50,50,0,200,12,'normal','transparent','1px solid #000000')">
                            <span class="material-symbols-outlined">vertical_shades</span> 直線
                        </button>
                        <button class="btn"
                            onclick="addEl('formula','=SUM()',50,50,120,30,12,'normal','#fffde7','1px solid #fbc02d')">
                            <span class="material-symbols-outlined">functions</span> 公式
                        </button>
                    </div>
                    <button class="btn btn-block" onclick="openModal('modal-tbl')">
                        <span class="material-symbols-outlined">table_chart</span> 插入標準表格
                    </button>
                    <p class="hint-text">表格可用於處理大量數據行</p>

                    <hr class="section-divider">
                    <p class="section-title">頁首/頁尾</p>
                    <div class="btn-grid">
                        <button class="btn" onclick="addEl('header','頁首文字',20,10,200,20,10,'normal')">
                            <span class="material-symbols-outlined">vertical_align_top</span> 頁首
                        </button>
                        <button class="btn" onclick="addEl('footer','第 {{PAGE}} 頁',20,null,150,20,10,'normal')">
                            <span class="material-symbols-outlined">vertical_align_bottom</span> 頁尾
                        </button>
                    </div>
                    <p class="hint-text">支援變數：{{PAGE}}, {{TOTAL}}, {{DATE}}</p>

                    <hr class="section-divider">
                    <p class="section-title">多選工具</p>
                    <div class="btn-grid" id="align-tools">
                        <button class="btn" onclick="alignElements('left')" title="靠左對齊">
                            <span class="material-symbols-outlined">align_horizontal_left</span>
                        </button>
                        <button class="btn" onclick="alignElements('center')" title="水平置中">
                            <span class="material-symbols-outlined">align_horizontal_center</span>
                        </button>
                        <button class="btn" onclick="alignElements('right')" title="靠右對齊">
                            <span class="material-symbols-outlined">align_horizontal_right</span>
                        </button>
                        <button class="btn" onclick="alignElements('top')" title="靠上對齊">
                            <span class="material-symbols-outlined">align_vertical_top</span>
                        </button>
                        <button class="btn" onclick="alignElements('middle')" title="垂直置中">
                            <span class="material-symbols-outlined">align_vertical_center</span>
                        </button>
                        <button class="btn" onclick="alignElements('bottom')" title="靠下對齊">
                            <span class="material-symbols-outlined">align_vertical_bottom</span>
                        </button>
                    </div>
                    <button class="btn btn-block" onclick="selectAll()" style="margin-top:8px" title="Ctrl+A / Cmd+A">
                        <span class="material-symbols-outlined">select_all</span> 全選所有元件
                    </button>
                    <p class="hint-text">按住 Shift 點擊多選 / Ctrl+A 全選</p>
                </section>

                <!-- Tab 2: Data & Background -->
                <section id="t2" class="tab-content">
                    <div class="panel-section">
                        <label class="form-label form-label-accent">📄 PDF 底圖 (描圖用)</label>
                        <button class="btn btn-block" onclick="document.getElementById('f-pdf').click()">
                            <span class="material-symbols-outlined">upload_file</span> 上傳 PDF 範本
                        </button>
                        <input type="file" id="f-pdf" class="hidden-input" accept=".pdf">
                        <div id="bg-ctrl" class="bg-controls">
                            <label class="form-label">底圖透明度</label>
                            <input type="range" min="0" max="100" value="0" class="form-control"
                                oninput="updBgOp(this.value)">
                            <button class="btn btn-danger btn-block" style="margin-top:5px"
                                onclick="clrBg()">清除底圖</button>
                        </div>
                    </div>

                    <label class="form-label form-label-accent">📊 匯入資料</label>
                    <div class="btn-grid">
                        <button class="btn btn-block" onclick="document.getElementById('f-data').click()">
                            <span class="material-symbols-outlined">upload_file</span> Excel/CSV
                        </button>
                        <button class="btn btn-block" onclick="openModal('modal-json')">
                            <span class="material-symbols-outlined">data_object</span> JSON
                        </button>
                    </div>
                    <input type="file" id="f-data" class="hidden-input" accept=".csv,.xlsx,.xls">

                    <div id="data-info" class="data-info hidden">
                        <div class="data-info-header">
                            <span id="data-count">0 筆資料</span>
                            <button class="btn btn-sm" onclick="openModal('modal-data-preview')">預覽</button>
                            <button class="btn btn-sm btn-danger" onclick="clearData()">清除</button>
                        </div>
                    </div>

                    <div id="field-list" class="field-list"></div>

                    <hr class="section-divider">
                    <label class="form-label form-label-accent">🎨 條件格式</label>
                    <div class="form-group">
                        <label class="form-label">數值欄位顏色</label>
                        <select class="form-control" id="cond-format" onchange="setCondFormat(this.value)">
                            <option value="none">無</option>
                            <option value="sign">正值綠/負值紅</option>
                            <option value="heat">熱力圖</option>
                        </select>
                    </div>

                    <hr class="section-divider">
                    <label class="form-label form-label-accent">🔖 浮水印</label>
                    <div class="form-group">
                        <input type="text" class="form-control" id="watermark-text" placeholder="例：草稿、機密">
                    </div>
                    <button class="btn btn-block" onclick="setWatermark()">套用浮水印</button>
                </section>

                <!-- Tab 3: Templates -->
                <section id="t3" class="tab-content">
                    <div class="template-card">
                        <span class="template-card-title">🚀 您的需求：</span>
                        <button class="btn btn-primary btn-block" style="text-align:left;font-weight:bold"
                            onclick="genGovTable()">
                            <span class="material-symbols-outlined">playlist_add</span> 建立「收支概況彙總表」
                        </button>
                        <p class="template-card-hint">自動生成：複雜表頭、合併欄位線條、數據表格</p>
                    </div>

                    <hr class="section-divider">
                    <p class="section-title">其他範例</p>
                    <button class="btn btn-block" style="margin-bottom:8px" onclick="loadDemo('invoice')">🧾
                        發票範例</button>
                    <button class="btn btn-block" onclick="loadDemo('label')">🏷️ 標籤範例</button>

                    <hr class="section-divider">
                    <p class="section-title">分組與小計</p>
                    <div class="form-group">
                        <label class="form-label">分組欄位</label>
                        <select class="form-control" id="group-field">
                            <option value="">-- 選擇欄位 --</option>
                        </select>
                    </div>
                    <button class="btn btn-block" onclick="enableGrouping()">啟用分組小計</button>
                </section>
            </div>
        </aside>

        <!-- Center: Canvas -->
        <section class="center-panel" id="canvas-wrap">
            <div class="canvas canvas-grid" id="canvas">
                <div id="splitLine"></div>
                <div id="guideX" class="guide-line guide-x"></div>
                <div id="guideY" class="guide-line guide-y"></div>
                <div id="watermark" class="watermark"></div>
            </div>
            <div class="floating-toolbar" id="floatBar">
                <button class="btn" onclick="dupEl()" title="複製">
                    <span class="material-symbols-outlined">content_copy</span>
                </button>
                <button class="btn" onclick="zOrder(1)" title="移至最上層">
                    <span class="material-symbols-outlined">flip_to_front</span>
                </button>
                <button class="btn" onclick="zOrder(-1)" title="移至最下層">
                    <span class="material-symbols-outlined">flip_to_back</span>
                </button>
                <button class="btn" onclick="toggleLock()" title="鎖定/解鎖" id="btn-lock">
                    <span class="material-symbols-outlined">lock_open</span>
                </button>
                <button class="btn btn-danger" onclick="delEl()" title="刪除">
                    <span class="material-symbols-outlined">delete</span>
                </button>
            </div>
            <div class="selection-box" id="selectionBox"></div>
        </section>

        <!-- Right Panel: Properties -->
        <aside class="right-panel" id="right-panel">
            <button class="panel-toggle panel-toggle-right" id="toggle-right" onclick="togglePanel('right')"
                title="收合/展開右側面板">
                <span class="material-symbols-outlined">chevron_right</span>
            </button>
            <div class="panel-content" id="right-panel-content">
                <div class="panel-header">屬性設定</div>
                <div id="props" style="padding:15px"></div>
            </div>
        </aside>
    </main>

    <!-- Modal: Insert Table -->
    <div class="modal-overlay" id="modal-tbl">
        <div class="modal">
            <h3>插入標準表格</h3>
            <div class="form-group">
                <label class="form-label">欄位數量</label>
                <input type="number" id="tbl-cols" value="5" class="form-control">
            </div>
            <div class="form-group">
                <label class="form-label">表頭高度 (0=隱藏)</label>
                <input type="number" id="tbl-hh" value="30" class="form-control">
            </div>
            <div class="modal-actions">
                <button class="btn btn-block" onclick="closeModal('modal-tbl')">取消</button>
                <button class="btn btn-primary btn-block" onclick="addTable()">插入</button>
            </div>
        </div>
    </div>

    <!-- Modal: JSON Import -->
    <div class="modal-overlay" id="modal-json">
        <div class="modal modal-lg">
            <h3>匯入 JSON 資料</h3>
            <div class="form-group">
                <label class="form-label">貼上 JSON 陣列 (例：[{"name":"A"},{"name":"B"}])</label>
                <textarea id="json-input" class="form-control" rows="8"
                    placeholder='[{"欄位1":"值1","欄位2":"值2"}]'></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-block" onclick="closeModal('modal-json')">取消</button>
                <button class="btn btn-primary btn-block" onclick="importJson()">匯入</button>
            </div>
        </div>
    </div>

    <!-- Modal: Data Preview -->
    <div class="modal-overlay" id="modal-data-preview">
        <div class="modal modal-xl">
            <h3>資料預覽 <span id="preview-count"></span></h3>
            <div class="data-preview-table" id="data-preview-content"></div>
            <div class="modal-actions">
                <button class="btn btn-block" onclick="closeModal('modal-data-preview')">關閉</button>
            </div>
        </div>
    </div>

    <!-- Modal: Template Library -->
    <div class="modal-overlay" id="modal-templates">
        <div class="modal modal-lg">
            <h3>範本庫</h3>
            <div id="template-list" class="template-list">
                <p class="hint-text">尚無儲存的範本</p>
            </div>
            <hr class="section-divider">
            <div class="form-group">
                <label class="form-label">儲存為新範本</label>
                <input type="text" id="template-name" class="form-control" placeholder="範本名稱">
            </div>
            <div class="modal-actions">
                <button class="btn btn-block" onclick="closeModal('modal-templates')">關閉</button>
                <button class="btn btn-primary btn-block" onclick="saveTemplate()">儲存範本</button>
            </div>
        </div>
    </div>

    <!-- Modal: Print Preview -->
    <div class="modal-overlay" id="modal-preview">
        <div class="modal modal-xl">
            <h3>分頁預覽</h3>
            <div id="preview-pages" class="preview-pages"></div>
            <div class="modal-actions">
                <button class="btn btn-block" onclick="closeModal('modal-preview')">關閉</button>
                <button class="btn btn-block" onclick="printDoc()">🖨 列印</button>
                <button class="btn btn-primary btn-block" onclick="downloadPdf()">📥 下載 PDF</button>
            </div>
        </div>
    </div>

    <!-- Print Container -->
    <div id="print-container"></div>

    <!-- Application Script -->
    <script src="js/app.js"></script>
</body>

</html>